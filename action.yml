name: 'Prepare static NextJS build'
description: 'Greet someone'
runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: 16
    - run: echo "NEXT_PUBLIC_BUILD_VERSION=${{ github.run_number }}" >> $GITHUB_ENV   
      shell: bash
    - run: echo "NEXT_PUBLIC_BUILD_ENVIRONMENT=${{ vars.BUILD_ENVIRONMENT }}" >> $GITHUB_ENV      
      shell: bash
    - run: echo "NEXT_PUBLIC_COMMIT_ID=$(git rev-parse --short ${{ github.sha }})" >> $GITHUB_ENV
      shell: bash
    - id: cache-node-modules
      uses: actions/cache@v3
      with:
        path: node_modules
        key: ${{ runner.os }}-node-modules-${{ github.run_id }}
        restore-keys: |
          ${{ runner.os }}-node-modules-
    - run: npm i
      shell: bash
    - run: npm run lint
      shell: bash
    - run: npm run build
      shell: bash
    - run: npm run export
      shell: bash
    - uses: actions/upload-artifact@v3 
      with:
        name: build
        path: ./out  